#!/bin/bash### pre-process .bam files# convert to fastq (samtools)
module load samtoolscd <path_to_bam_files>mkdir convertsamtools bam2fq -n $PREFIX.bam > convert/$PREFIX.fq# where $PREFIX is the prefix to the bam file accessed from NCBI# quality control (trimgalore)
module load TrimGalore/0.4.4module load pythoncd <path_to_bam_files>/convertmkdir trimtrim_galore $PREFIX.fq -q 30 -o trim# merge paired ends (bbmerge; https://github.com/BioInfoTools/BBMap)cd <path_to_bam_files>/convert/trimmkdir merge<path_to_bbmap_tools>/bbmap/sh/bbmerge.sh in=$PREFIX_trimmed.fq out=merge/$PREFIX_merged.fq outu=merge/$PREFIX_unmerged.fq ihist=merge/$PREFIX_hist.fq### assemble genomes (spades)cd <path_to_bam_files>/convert/trim/mergemkdir assembliesspades.py -s $PREFIX_merged.fq -o assemblies/$ASSEMBLY -t 24# where $ASSEMBLY is the directory containing all assembly files (e.g., contains.fasta, scaffolds.fasta)### quality check (checkm)cd <path_to_strain_genome_assembly_files>module load checkmcheckm taxonomy_wf domain Bacteria assemblies/ checkm/ -x fasta -f checkm/checkm_list.txt# note that ‘domain Bacteria’ is to be substituted for more specific taxonomy for the respective genome (e.g., ‘genus Escherichia’)### genome annotation (prokka)cd <path_to_strain_genome_assembly_files>module load prokkaprokka --genus $GENUS --outdir prokka/$ASSEMBLY--locustag $ASSEMBLY assemblies/$ASSEMBLY/scaffolds.fasta# where $ASSEMBLY is the assembly directory/prefix and $GENUS is the respective genus name of the strain